### **DNS解析过程**

DNS 在解析域名的时候有两种方式：**递归查询和迭代查询**。

 **递归查询**：

主机向本地域名服务器的查询一般都是采用**递归查询 **。

如果主机所询问的本地域名服务器不知道被查询的域名的IP地址，那么本地域名服务器就以DNS客户的身份，向其根域名服务器继续发出查询请求报文(即替主机继续查询)，而不是让主机自己进行下一步查询。因此，递归查询返回的查询结果是所要查询的IP地址，或者是返回一个失败的响应，表示无法查询到所需的IP地址。

**迭代查询**：

本地域名服务器向根域名服务器的查询通常是采用**迭代查询**。

当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么返回给本地域名服务器所要查询的IP地址，要么返回给本地域名服务器下一步应当查询的域名服务器的IP地址。

**查询步骤**：

① 主机先在浏览器缓存，系统缓存，hosts静态文件、路由器缓存中查找某主机的ip地址，如果没有再向其本地域名服务器进行**递归查询**，如果缓存中没有，继续下一步。

② 本地域名服务器采用**迭代查询**，先向一个**根域名服务器**查询。

③ 根域名服务器告诉本地域名服务器，下一次查询的**顶级域名服务器**ip地址 。

④ 本地域名服务器向顶级域名服务器 。

⑤ 顶级域名服务器告诉本地DNS服务器下一次应查询的**权限域名服务器**的ip地址。

⑥ 本地域名服务器向权限域名服务器的ip地址进行查询。

⑦ 权限域名服务器告诉本地域名服务器，所查询的主机的IP地址。

⑧ 本地域名服务器最后把查询结果告诉主机。

### **什么是DNS劫持**

#### DNS劫持 vs HTTP劫持

DNS劫持现象：你输入一个google.com网址，出来的是百度的页面

HTTP劫持现象：访问着github的页面，右下角出现了一个格格不入的广告弹窗

**好比：**DNS劫持是你想去机场的时候，把你给丢到火车站。 HTTP劫持是你去机场途中，有人给你塞小广告



在dns解析过程中，有哪一环节出现问题的话，都可能会导致DNS解析错误，导致客户端（浏览器）得到一个假的ip地址，从而引导用户访问到这个冒名顶替，恶意的网站。

#### **DNS劫持带来的危害：**

1. 钓鱼诈骗

2. 网上购物支付安全

3. 泄露个人隐私

4. 轻则影响网速，重则不能上网

#### DNS劫持的方法

![img](http://user-gold-cdn.xitu.io/2019/6/11/16b464983affd008?imageView2)

**1.本机DNS劫持**

攻击者通过某些手段使用户的计算机感染上木马病毒，或者恶意软件之后，恶意修改本地DNS配置，比如修改本地hosts文件，缓存等

**2. 路由DNS劫持**

很多用户默认路由器的默认密码，攻击者可以侵入到路由管理员账号中，修改路由器的默认配置

**3.攻击DNS服务器**

直接攻击DNS服务器，例如对DNS服务器进行DDOS攻击，可以是DNS服务器宕机，出现异常请求，还可以利用某些手段感染dns服务器的缓存，使给用户返回来的是恶意的ip地址

#### DNS的防范

> 就这上面的劫持方法，说几种方法手段

**1. 加强本地计算机病毒检查，开启防火墙等，防止恶意软件，木马病毒感染计算机**

**2. 改变路由器默认密码，防止攻击者修改路由器的DNS配置指向恶意的DNS服务器**

**3. 企业的话可以准备两个以上的域名，一旦一个域名挂掉，还可以使用另一个**

**4. 用HTTP DNS 代替 Local DNS**

